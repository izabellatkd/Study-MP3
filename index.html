<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MP3 Player</title>
<style>
/* ... all your existing CSS stays the same ... */
</style>
<body>
<div class="window" id="mainWindow">
  <div class="titlebar">
    <span>MP3 Player</span>
    <span>▢ ✖</span>
  </div>

  <div class="screen" id="screen">
    <img src="covers/cover1.jpg" alt="Album Art">
  </div>

  <div class="controls">
    <button id="prevBtn">⏮</button>
    <button id="playBtn">▶</button>
    <button id="nextBtn">⏭</button>
    <button id="shuffleBtn">🔀</button>
    <button id="repeatBtn">🔁</button>
    <button id="playlistToggle">🎶</button>
  </div>

  <div class="track-title" id="trackTitle">Loading...</div>

  <div class="progress-container">
    <span id="currentTime">0:00</span>
    <input type="range" id="progress" class="progress" value="0" min="0" max="100">
    <span id="duration">0:00</span>
  </div>

  <div class="waveform" id="waveform">
    <div class="bar"></div><div class="bar"></div><div class="bar"></div>
    <div class="bar"></div><div class="bar"></div><div class="bar"></div>
    <div class="bar"></div><div class="bar"></div><div class="bar"></div>
    <div class="bar"></div><div class="bar"></div><div class="bar"></div>
    <div class="bar"></div><div class="bar"></div><div class="bar"></div>
    <div class="bar"></div><div class="bar"></div><div class="bar"></div>
    <div class="bar"></div><div class="bar"></div><div class="bar"></div>
  </div>

  <div class="volume-container">
    <label for="volume">🔊</label>
    <input type="range" id="volume" min="0" max="1" step="0.01" value="1">
  </div>

  <div class="playlist-popup" id="playlistPopup">
    <div class="titlebar">
      <span>Playlist</span>
      <span id="playlistClose">✖</span>
    </div>
    <ul id="playlist"></ul>
  </div>

  <audio id="audio"></audio>
</div>

<script>
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const shuffleBtn = document.getElementById('shuffleBtn');
const repeatBtn = document.getElementById('repeatBtn');
const playlistToggle = document.getElementById('playlistToggle');
const playlistPopup = document.getElementById('playlistPopup');
const playlistClose = document.getElementById('playlistClose');
const playlist = document.getElementById('playlist');
const progress = document.getElementById('progress');
const currentTimeEl = document.getElementById('currentTime');
const durationEl = document.getElementById('duration');
const volume = document.getElementById('volume');
const screen = document.getElementById('screen');
const trackTitle = document.getElementById('trackTitle');
const bars = document.querySelectorAll('.bar');

const tracks = [
  { name: "Sunset Drive", url: "music/song1.mp3", cover: "covers/cover1.jpg" },
  { name: "Beach Vibes", url: "music/song2.mp3", cover: "covers/cover2.jpg" },
  { name: "Late Night Pool", url: "music/song3.mp3", cover: "covers/cover3.jpg" },
  { name: "Neon Nights", url: "music/song4.mp3", cover: "covers/cover4.jpg" }
];

let currentIndex = 0;
let isPlaying = false;
let isShuffle = false;
let repeatMode = 0;

// Playlist rendering
function renderPlaylist(){
  playlist.innerHTML='';
  tracks.forEach((track,i)=>{
    const li=document.createElement('li');
    li.textContent=track.name;
    if(i===currentIndex) li.classList.add('active');
    li.onclick=()=>{loadTrack(i); togglePlaylist(false);}
    playlist.appendChild(li);
  });
}

function loadTrack(index){
  currentIndex=index;
  audio.src=tracks[index].url;
  trackTitle.textContent=tracks[index].name;
  screen.innerHTML=`<img src="${tracks[index].cover}" alt="Cover">`;
  audio.play();
  isPlaying=true;
  playBtn.textContent="⏸";
  setWaveform(true);
  renderPlaylist();
}

function togglePlay(){
  if(isPlaying){ audio.pause(); playBtn.textContent="▶"; setWaveform(false);}
  else{ audio.play(); playBtn.textContent="⏸"; setWaveform(true);}
  isPlaying=!isPlaying;
}

function prevTrack(){ loadTrack((currentIndex-1+tracks.length)%tracks.length); }

function nextTrack(){
  if(isShuffle){
    let nextIndex;
    do{ nextIndex=Math.floor(Math.random()*tracks.length); }
    while(nextIndex===currentIndex && tracks.length>1);
    loadTrack(nextIndex);
  } else {
    if(repeatMode===2){ loadTrack(currentIndex); }
    else{
      currentIndex=(currentIndex+1)%tracks.length;
      if(currentIndex===0 && repeatMode===0){ audio.pause(); playBtn.textContent="▶"; setWaveform(false); }
      else loadTrack(currentIndex);
    }
  }
}

function updateProgress(){
  if(audio.duration){
    progress.value=(audio.currentTime/audio.duration)*100;
    currentTimeEl.textContent=formatTime(audio.currentTime);
    durationEl.textContent=formatTime(audio.duration);
  }
}

function formatTime(seconds){ const mins=Math.floor(seconds/60); const secs=Math.floor(seconds%60); return `${mins}:${secs<10?'0':''}${secs}`; }

progress.addEventListener('input',()=>{ audio.currentTime=(progress.value/100)*audio.duration; });
volume.addEventListener('input',()=>{ audio.volume=volume.value; });
audio.addEventListener('timeupdate',updateProgress);
audio.addEventListener('ended',nextTrack);

playBtn.addEventListener('click',togglePlay);
prevBtn.addEventListener('click',prevTrack);
nextBtn.addEventListener('click',nextTrack);
shuffleBtn.addEventListener('click',()=>{ isShuffle=!isShuffle; shuffleBtn.style.background=isShuffle?"#b8e1e4":"#f9f0e9"; });
repeatBtn.addEventListener('click',()=>{ repeatMode=(repeatMode+1)%3; repeatBtn.style.background=repeatMode===0?"#f9f0e9":"#b8e1e4"; });
playlistToggle.addEventListener('click',()=>togglePlaylist());
playlistClose.addEventListener('click',()=>togglePlaylist(false));

function togglePlaylist(forceClose=null){
  if(forceClose===false) playlistPopup.style.display="none";
  else playlistPopup.style.display=playlistPopup.style.display==="block"?"none":"block";
}

// Waveform animation control
function setWaveform(active){
  bars.forEach(bar=>bar.style.animationPlayState=active?"running":"paused");
}

// Make playlist draggable
const popupTitleBar = playlistPopup.querySelector('.titlebar');
let isDragging = false;
let offsetX, offsetY;

popupTitleBar.addEve
