<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Retro MP3 Player</title>
  <style>
    body {
      background: #ffffff;
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 0;
    }

    /* Popup window */
    #playerPopup {
      position: fixed;
      top: 50px;
      left: 50px;
      width: 400px;
      background: #f9f0e9;
      border: 2px solid #ccc;
      box-shadow: 4px 4px 0 #a2c6c8;
      border-radius: 8px;
      display: none;
      flex-direction: column;
      z-index: 1000;
    }

    /* Title bar */
    #titleBar {
      background: #b8e1e4;
      padding: 8px;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      color: #333;
    }

    #titleBar .controls {
      display: flex;
      gap: 8px;
    }

    #titleBar .controls span {
      width: 14px;
      height: 14px;
      display: inline-block;
      border-radius: 50%;
      background: #f9f0e9;
      border: 2px solid #ccc;
      text-align: center;
      line-height: 10px;
      font-size: 10px;
      cursor: pointer;
    }

    /* Track title wrapper with scrolling */
    .track-title-wrapper {
      width: 100%;
      overflow: hidden;
      white-space: nowrap;
      box-sizing: border-box;
      background: #f9f0e9;
      padding: 4px 8px;
    }

    .scrolling-title {
      display: inline-block;
      padding-left: 100%; /* start from outside */
      animation: scroll-title 12s linear infinite;
      color: #333;
      font-weight: bold;
    }

    .scrolling-title:hover {
      animation-play-state: paused; /* Pause scroll on hover */
    }

    @keyframes scroll-title {
      0%   { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    /* Controls area */
    #controls {
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 10px;
      background: #f9f0e9;
    }

    button {
      background: #f9f0e9;
      border: 2px solid #ccc;
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      font-weight: bold;
      color: #333;
    }

    button#playPause {
      background: #b8e1e4;
    }

    /* Scrubbers */
    #scrubber,
    #volume {
      -webkit-appearance: none;
      width: 80%;
      height: 4px;
      background: #7B7B7B;
      border-radius: 2px;
      outline: none;
      margin: 10px auto;
      display: block;
    }

    #volume {
      width: 40%; /* shorter volume bar */
      margin-left: 10px;
    }

    /* Waveform */
    #waveform {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      height: 40px;
      margin: 8px 0;
      gap: 3px;
    }

    .bar {
      width: 6px;
      background: #7B7B7B;
      animation: bounce 1s infinite ease-in-out;
    }

    @keyframes bounce {
      0%, 100% { height: 10px; }
      50% { height: 40px; }
    }

    /* Playlist popup */
    #playlistPopup {
      display: none;
      position: absolute;
      bottom: 100%;
      left: 0;
      width: 100%;
      max-height: 200px;
      overflow-y: auto;
      background: #f9f0e9;
      border: 2px solid #ccc;
      box-shadow: 2px 2px 0 #a2c6c8;
      border-radius: 6px;
      z-index: 2000;
    }

    #playlistPopup div {
      padding: 6px;
      border-bottom: 1px solid #ccc;
      cursor: pointer;
    }

    #playlistPopup div:hover {
      background: #b8e1e4;
    }
  </style>
</head>
<body>
  <div id="playerPopup">
    <div id="titleBar">
      <span>MP3 Player</span>
      <div class="controls">
        <span id="closeBtn">×</span>
      </div>
    </div>

    <!-- Scrolling Track Title -->
    <div class="track-title-wrapper">
      <div id="track-title" class="scrolling-title">Track Title</div>
    </div>

    <!-- Controls -->
    <div id="controls">
      <button id="prev">⏮</button>
      <button id="playPause">▶</button>
      <button id="next">⏭</button>
      <button id="playlistToggle">☰</button>
    </div>

    <input type="range" id="scrubber" value="0" min="0" max="100">
    <input type="range" id="volume" value="100" min="0" max="100">

    <!-- Waveform -->
    <div id="waveform"></div>

    <!-- Playlist Popup -->
    <div id="playlistPopup"></div>
  </div>

  <script>
    const playPauseBtn = document.getElementById('playPause');
    const scrubber = document.getElementById('scrubber');
    const volume = document.getElementById('volume');
    const trackTitle = document.getElementById('track-title');
    const waveform = document.getElementById('waveform');
    const playlistPopup = document.getElementById('playlistPopup');
    const playlistToggle = document.getElementById('playlistToggle');
    const closeBtn = document.getElementById('closeBtn');

    let audio = new Audio();
    let playlist = [
      { title: "Track 1", src: "music/track1.mp3" },
      { title: "Track 2", src: "music/track2.mp3" },
      { title: "Track 3", src: "music/track3.mp3" }
    ];
    let currentIndex = 0;

    function loadTrack(index) {
      currentIndex = index;
      audio.src = playlist[index].src;
      trackTitle.textContent = playlist[index].title;
      audio.play();
      playPauseBtn.textContent = "⏸";
    }

    playPauseBtn.addEventListener('click', () => {
      if (audio.paused) {
        audio.play();
        playPauseBtn.textContent = "⏸";
      } else {
        audio.pause();
        playPauseBtn.textContent = "▶";
      }
    });

    audio.addEventListener('timeupdate', () => {
      scrubber.value = (audio.currentTime / audio.duration) * 100 || 0;
    });

    scrubber.addEventListener('input', () => {
      audio.currentTime = (scrubber.value / 100) * audio.duration;
    });

    volume.addEventListener('input', () => {
      audio.volume = volume.value / 100;
    });

    document.getElementById('prev').addEventListener('click', () => {
      loadTrack((currentIndex - 1 + playlist.length) % playlist.length);
    });

    document.getElementById('next').addEventListener('click', () => {
      loadTrack((currentIndex + 1) % playlist.length);
    });

    // Auto play next song
    audio.addEventListener('ended', () => {
      loadTrack((currentIndex + 1) % playlist.length);
    });

    // Populate waveform
    for (let i = 0; i < 21; i++) {
      let bar = document.createElement('div');
      bar.classList.add('bar');
      bar.style.animationDelay = `${i * 0.1}s`;
      waveform.appendChild(bar);
    }

    // Playlist popup
    playlistToggle.addEventListener('click', () => {
      playlistPopup.style.display = playlistPopup.style.display === 'block' ? 'none' : 'block';
      playlistPopup.innerHTML = '';
      playlist.forEach((track, i) => {
        let div = document.createElement('div');
        div.textContent = track.title;
        div.addEventListener('click', () => {
          loadTrack(i);
          playlistPopup.style.display = 'none';
        });
        playlistPopup.appendChild(div);
      });
    });

    closeBtn.addEventListener('click', () => {
      document.getElementById('playerPopup').style.display = 'none';
    });

    // Dragging functionality for popup
    const playerPopup = document.getElementById('playerPopup');
    const titleBar = document.getElementById('titleBar');
    let offsetX, offsetY, isDragging = false;

    titleBar.addEventListener('mousedown', (e) => {
      isDragging = true;
      offsetX = e.clientX - playerPopup.offsetLeft;
      offsetY = e.clientY - playerPopup.offsetTop;
    });

    document.addEventListener('mousemove', (e) => {
      if (isDragging) {
        playerPopup.style.left = (e.clientX - offsetX) + 'px';
        playerPopup.style.top = (e.clientY - offsetY) + 'px';
      }
    });

    document.addEventListener('mouseup', () => {
      isDragging = false;
    });

    // Load first track
    loadTrack(0);
  </script>
</body>
</html>
